From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: violetc <58360096+s-yh-china@users.noreply.github.com>
Date: Mon, 15 Aug 2022 10:18:36 +0800
Subject: [PATCH] Config to disable method profiler

This patch is Powered by Pufferfish(https://github.com/pufferfish-gg/Pufferfish)

diff --git a/net/minecraft/server/MinecraftServer.java b/net/minecraft/server/MinecraftServer.java
index 3965e4ed4381ee4b21c7c93a0b7853d756be6ae8..db16841b42ff4b3e2ac8df6c15561367b35d977a 100644
--- a/net/minecraft/server/MinecraftServer.java
+++ b/net/minecraft/server/MinecraftServer.java
@@ -1339,7 +1339,7 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
 
                 // Paper - improve tick loop - done above
 
-                try (Profiler.Scope scope = Profiler.use(this.createProfiler())) {
+                try (Profiler.Scope scope = org.leavesmc.leaves.LeavesConfig.mics.disableMethodProfiler ? null : Profiler.use(this.createProfiler())) { // Leaves - disable profiler
                     this.processPacketsAndTick(flag);
                     ProfilerFiller profilerFiller = Profiler.get();
                     profilerFiller.push("nextTickWait");
diff --git a/net/minecraft/util/profiling/Profiler.java b/net/minecraft/util/profiling/Profiler.java
index 9567003a8ed1a3783b743553ce8f690756da868d..40b169c0f2831f547a4377f119929d6185a94aa8 100644
--- a/net/minecraft/util/profiling/Profiler.java
+++ b/net/minecraft/util/profiling/Profiler.java
@@ -45,6 +45,7 @@ public final class Profiler {
     }
 
     public static ProfilerFiller get() {
+        if (org.leavesmc.leaves.LeavesConfig.mics.disableMethodProfiler) return InactiveProfiler.INSTANCE; // Leaves - disable profiler
         return ACTIVE_COUNT.get() == 0 ? getDefaultFiller() : Objects.requireNonNullElseGet(ACTIVE.get(), Profiler::getDefaultFiller);
     }
 
