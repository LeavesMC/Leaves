From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Lumine1909 <133463833+Lumine1909@users.noreply.github.com>
Date: Sat, 29 Nov 2025 23:32:57 +0800
Subject: [PATCH] Force minecraft command


diff --git a/net/minecraft/commands/Commands.java b/net/minecraft/commands/Commands.java
index 668eb52d71d77f75c24d4840be9a6c49d96dfc34..f4452de35a589612c11b413f6e09524b90d2d507 100644
--- a/net/minecraft/commands/Commands.java
+++ b/net/minecraft/commands/Commands.java
@@ -185,7 +185,21 @@ public class Commands {
             return !requirement.test(this.noPermissionSource);
         }
     };
-    private final CommandDispatcher<CommandSourceStack> dispatcher = new CommandDispatcher<>();
+    // Leaves start - force minecraft command
+    private final CommandDispatcher<CommandSourceStack> dispatcher = new CommandDispatcher<>() {
+
+        @Override
+        public com.mojang.brigadier.tree.LiteralCommandNode<CommandSourceStack> register(com.mojang.brigadier.builder.LiteralArgumentBuilder<net.minecraft.commands.CommandSourceStack> command) {
+            try {
+                if (org.leavesmc.leaves.LeavesConfig.mics.forceMinecraftCommand && getRoot().getChild("minecraft:" + command.getLiteral()) != null) {
+                    return command.build();
+                }
+            } catch (Exception ignored) {
+            }
+            return super.register(command);
+        }
+    };
+    // Leaves end - force minecraft command
 
     public Commands(Commands.CommandSelection selection, CommandBuildContext context) {
     // Paper start - Brigadier API - modern minecraft overloads that do not use redirects but are copies instead
