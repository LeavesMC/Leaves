From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: violetc <58360096+s-yh-china@users.noreply.github.com>
Date: Mon, 15 Aug 2022 10:18:36 +0800
Subject: [PATCH] Config to disable method profiler

This patch is Powered by Pufferfish(https://github.com/pufferfish-gg/Pufferfish)

diff --git a/src/main/java/net/minecraft/server/MinecraftServer.java b/src/main/java/net/minecraft/server/MinecraftServer.java
index 59d4bc687af52ffb2b8529ce91a5703492fce96f..601d12cc2e0f2e180882f6b8c878e24a0856d082 100644
--- a/src/main/java/net/minecraft/server/MinecraftServer.java
+++ b/src/main/java/net/minecraft/server/MinecraftServer.java
@@ -1320,7 +1320,7 @@ public abstract class MinecraftServer extends ReentrantBlockableEventLoop<TickTa
                 this.nextTickTimeNanos += i;
 
                 try {
-                    Profiler.Scope profiler_a = Profiler.use(this.createProfiler());
+                    Profiler.Scope profiler_a = org.leavesmc.leaves.LeavesConfig.disableMethodProfiler ? null : Profiler.use(this.createProfiler()); // Leaves - disable profiler
 
                     try {
                         ProfilerFiller gameprofilerfiller = Profiler.get();
diff --git a/src/main/java/net/minecraft/util/profiling/Profiler.java b/src/main/java/net/minecraft/util/profiling/Profiler.java
index fe8a8ee1f88c58a9fe730c4c0cc5fc4e3651e9f8..1c2bead15410adec68f7a9fecb8bc94f8636aeb2 100644
--- a/src/main/java/net/minecraft/util/profiling/Profiler.java
+++ b/src/main/java/net/minecraft/util/profiling/Profiler.java
@@ -44,6 +44,7 @@ public final class Profiler {
     }
 
     public static ProfilerFiller get() {
+        if (org.leavesmc.leaves.LeavesConfig.disableMethodProfiler) return InactiveProfiler.INSTANCE; // Leaves - disable profiler
         return ACTIVE_COUNT.get() == 0 ? getDefaultFiller() : Objects.requireNonNullElseGet(ACTIVE.get(), Profiler::getDefaultFiller);
     }
 
