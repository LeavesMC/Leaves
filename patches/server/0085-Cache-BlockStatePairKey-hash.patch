From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: violetc <58360096+s-yh-china@users.noreply.github.com>
Date: Tue, 18 Jul 2023 14:59:26 +0800
Subject: [PATCH] Cache BlockStatePairKey hash

This patch is Powered by Gale(https://github.com/GaleMC/Gale)

diff --git a/src/main/java/net/minecraft/world/level/block/Block.java b/src/main/java/net/minecraft/world/level/block/Block.java
index e27f2317e4e2f13b6ef12be727046497a750fd3a..99d978d949311c28b6d39d05d4f7e3aeafb791e6 100644
--- a/src/main/java/net/minecraft/world/level/block/Block.java
+++ b/src/main/java/net/minecraft/world/level/block/Block.java
@@ -602,11 +602,18 @@ public class Block extends BlockBehaviour implements ItemLike {
         private final BlockState first;
         private final BlockState second;
         private final Direction direction;
+        private final int hash; // Leaves - cache BlockStatePairKey hash
 
         public BlockStatePairKey(BlockState self, BlockState other, Direction facing) {
             this.first = self;
             this.second = other;
             this.direction = facing;
+            // Leaves start - cache BlockStatePairKey hash
+            int hash = this.first.hashCode();
+            hash = 31 * hash + this.second.hashCode();
+            hash = 31 * hash + this.direction.hashCode();
+            this.hash = hash;
+            // Leaves end - cache BlockStatePairKey hash
         }
 
         public boolean equals(Object object) {
@@ -622,11 +629,17 @@ public class Block extends BlockBehaviour implements ItemLike {
         }
 
         public int hashCode() {
-            int i = this.first.hashCode();
+            // Leaves start - cache BlockStatePairKey hash
+            if (!org.leavesmc.leaves.LeavesConfig.cacheBlockStatePairKeyHash) {
+                int i = this.first.hashCode();
 
-            i = 31 * i + this.second.hashCode();
-            i = 31 * i + this.direction.hashCode();
-            return i;
+                i = 31 * i + this.second.hashCode();
+                i = 31 * i + this.direction.hashCode();
+                return i;
+            } else {
+                return this.hash;
+            }
+            // Leaves end - cache BlockStatePairKey hash
         }
     }
 }
